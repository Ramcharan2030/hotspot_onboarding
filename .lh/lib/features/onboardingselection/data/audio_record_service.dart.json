{
    "sourceFile": "lib/features/onboardingselection/data/audio_record_service.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1762859657986,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762860038398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,31 +1,31 @@\n-import 'dart:io';\r\n-import 'package:record/record.dart';\r\n-import 'package:path_provider/path_provider.dart';\r\n-import 'package:path/path.dart' as path;\r\n+// import 'dart:io';\r\n+// import 'package:record/record.dart';\r\n+// import 'package:path_provider/path_provider.dart';\r\n+// import 'package:path/path.dart' as path;\r\n \r\n-class AudioRecorderService {\r\n-  final Record _record = Record();\r\n+// class AudioRecorderService {\r\n+//   final Record _record = Record();\r\n \r\n-  Future<String?> startRecording() async {\r\n-    if (await _record.hasPermission()) {\r\n-      final dir = await getApplicationDocumentsDirectory();\r\n-      final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n-      await _record.start(path: filePath);\r\n-      return filePath;\r\n-    }\r\n-    return null;\r\n-  }\r\n+//   Future<String?> startRecording() async {\r\n+//     if (await _record.hasPermission()) {\r\n+//       final dir = await getApplicationDocumentsDirectory();\r\n+//       final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n+//       await _record.start(path: filePath);\r\n+//       return filePath;\r\n+//     }\r\n+//     return null;\r\n+//   }\r\n \r\n-  Future<void> stopRecording() async {\r\n-    await _record.stop();\r\n-  }\r\n+//   Future<void> stopRecording() async {\r\n+//     await _record.stop();\r\n+//   }\r\n \r\n-  Future<void> cancelRecording(String filePath) async {\r\n-    final file = File(filePath);\r\n-    if (await file.exists()) {\r\n-      await file.delete();\r\n-    }\r\n-  }\r\n+//   Future<void> cancelRecording(String filePath) async {\r\n+//     final file = File(filePath);\r\n+//     if (await file.exists()) {\r\n+//       await file.delete();\r\n+//     }\r\n+//   }\r\n \r\n-  Future<bool> isRecording() async => await _record.isRecording();\r\n-}\r\n+//   Future<bool> isRecording() async => await _record.isRecording();\r\n+// }\r\n"
                },
                {
                    "date": 1762860083470,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,31 +1,31 @@\n-// import 'dart:io';\r\n-// import 'package:record/record.dart';\r\n-// import 'package:path_provider/path_provider.dart';\r\n-// import 'package:path/path.dart' as path;\r\n+import 'dart:io';\r\n+import 'package:record/record.dart';\r\n+import 'package:path_provider/path_provider.dart';\r\n+import 'package:path/path.dart' as path;\r\n \r\n-// class AudioRecorderService {\r\n-//   final Record _record = Record();\r\n+class AudioRecorderService {\r\n+  final Record _record = Record();\r\n \r\n-//   Future<String?> startRecording() async {\r\n-//     if (await _record.hasPermission()) {\r\n-//       final dir = await getApplicationDocumentsDirectory();\r\n-//       final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n-//       await _record.start(path: filePath);\r\n-//       return filePath;\r\n-//     }\r\n-//     return null;\r\n-//   }\r\n+  Future<String?> startRecording() async {\r\n+    if (await _record.hasPermission()) {\r\n+      final dir = await getApplicationDocumentsDirectory();\r\n+      final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n+      await _record.start(path: filePath);\r\n+      return filePath;\r\n+    }\r\n+    return null;\r\n+  }\r\n \r\n-//   Future<void> stopRecording() async {\r\n-//     await _record.stop();\r\n-//   }\r\n+  Future<void> stopRecording() async {\r\n+    await _record.stop();\r\n+  }\r\n \r\n-//   Future<void> cancelRecording(String filePath) async {\r\n-//     final file = File(filePath);\r\n-//     if (await file.exists()) {\r\n-//       await file.delete();\r\n-//     }\r\n-//   }\r\n+  Future<void> cancelRecording(String filePath) async {\r\n+    final file = File(filePath);\r\n+    if (await file.exists()) {\r\n+      await file.delete();\r\n+    }\r\n+  }\r\n \r\n-//   Future<bool> isRecording() async => await _record.isRecording();\r\n-// }\r\n+  Future<bool> isRecording() async => await _record.isRecording();\r\n+}\r\n"
                },
                {
                    "date": 1762860145175,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n import 'dart:io';\r\n import 'package:record/record.dart';\r\n+\r\n import 'package:path_provider/path_provider.dart';\r\n import 'package:path/path.dart' as path;\r\n \r\n class AudioRecorderService {\r\n"
                },
                {
                    "date": 1762860335706,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,32 +1,51 @@\n import 'dart:io';\r\n import 'package:record/record.dart';\r\n-\r\n import 'package:path_provider/path_provider.dart';\r\n import 'package:path/path.dart' as path;\r\n \r\n class AudioRecorderService {\r\n-  final Record _record = Record();\r\n+  final AudioRecorder _recorder = AudioRecorder();\r\n \r\n+  /// Start recording and return the file path\r\n   Future<String?> startRecording() async {\r\n-    if (await _record.hasPermission()) {\r\n-      final dir = await getApplicationDocumentsDirectory();\r\n-      final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n-      await _record.start(path: filePath);\r\n-      return filePath;\r\n-    }\r\n-    return null;\r\n+    final hasPermission = await _recorder.hasPermission();\r\n+    if (!hasPermission) return null;\r\n+\r\n+    final dir = await getApplicationDocumentsDirectory();\r\n+    final filePath =\r\n+        path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n+\r\n+    await _recorder.start(\r\n+      const RecordConfig(encoder: AudioEncoder.aacLc),\r\n+      path: filePath,\r\n+    );\r\n+\r\n+    return filePath;\r\n   }\r\n \r\n+  /// Stop the recording safely\r\n   Future<void> stopRecording() async {\r\n-    await _record.stop();\r\n+    if (await _recorder.isRecording()) {\r\n+      await _recorder.stop();\r\n+    }\r\n   }\r\n \r\n+  /// Cancel & delete the current recording\r\n   Future<void> cancelRecording(String filePath) async {\r\n-    final file = File(filePath);\r\n-    if (await file.exists()) {\r\n-      await file.delete();\r\n+    try {\r\n+      final file = File(filePath);\r\n+      if (await file.exists()) {\r\n+        await file.delete();\r\n+      }\r\n+      await stopRecording();\r\n+    } catch (e) {\r\n+      print('Cancel recording error: $e');\r\n     }\r\n   }\r\n \r\n-  Future<bool> isRecording() async => await _record.isRecording();\r\n+  /// Check if currently recording\r\n+  Future<bool> isRecording() async {\r\n+    final recordState = await _recorder.isRecording();\r\n+    return recordState;\r\n+  }\r\n }\r\n"
                },
                {
                    "date": 1762865064476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,12 @@\n     final hasPermission = await _recorder.hasPermission();\r\n     if (!hasPermission) return null;\r\n \r\n     final dir = await getApplicationDocumentsDirectory();\r\n-    final filePath = p.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n+    final filePath = p.join(\r\n+      dir.path,\r\n+      'audio_${DateTime.now().millisecondsSinceEpoch}.m4a',\r\n+    );\r\n \r\n     // Start recording; let the package pick sensible defaults for encoder if needed\r\n     await _recorder.start(path: filePath);\r\n \r\n"
                },
                {
                    "date": 1762865073295,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,70 @@\n+import 'dart:io';\r\n+import 'package:record/record.dart';\r\n+import 'package:path_provider/path_provider.dart';\r\n+import 'package:path/path.dart' as p;\r\n+\r\n+class AudioRecorderService {\r\n+  final Record _recorder = Record();\r\n+\r\n+  /// Start recording and return the file path (or null if permission denied)\r\n+  Future<String?> startRecording() async {\r\n+    final hasPermission = await _recorder.hasPermission();\r\n+    if (!hasPermission) return null;\r\n+\r\n+    final dir = await getApplicationDocumentsDirectory();\r\n+    final filePath = p.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n+\r\n+    // Start recording; let the package pick sensible defaults for encoder if needed\r\n+    await _recorder.start(path: filePath);\r\n+\r\n+    return filePath;\r\n+  }\r\n+\r\n+  /// Stop the recording and return the recorded file path (or null if none)\r\n+  Future<String?> stopRecording() async {\r\n+    if (await _recorder.isRecording()) {\r\n+      try {\r\n+        final recordedPath = await _recorder.stop();\r\n+        return recordedPath;\r\n+      } catch (e) {\r\n+        // swallow and return null on error\r\n+        // ignore: avoid_print\r\n+        print('Stop recording error: $e');\r\n+        return null;\r\n+      }\r\n+    }\r\n+    return null;\r\n+  }\r\n+\r\n+  /// Delete a recorded file if it exists\r\n+  Future<void> deleteFile(String filePath) async {\r\n+    try {\r\n+      final file = File(filePath);\r\n+      if (await file.exists()) {\r\n+        await file.delete();\r\n+      }\r\n+    } catch (e) {\r\n+      // ignore: avoid_print\r\n+      print('Delete file error: $e');\r\n+    }\r\n+  }\r\n+\r\n+  /// Get a live amplitude value between 0.0 and 1.0 (returns 0.0 on error)\r\n+  Future<double> getAmplitude() async {\r\n+    try {\r\n+      final amp = await _recorder.getAmplitude();\r\n+      if (amp == null) return 0.0;\r\n+      // The `Amplitude` returned by the package has `current` and `max`.\r\n+      return amp.current ?? 0.0;\r\n+    } catch (e) {\r\n+      // ignore: avoid_print\r\n+      print('Get amplitude error: $e');\r\n+      return 0.0;\r\n+    }\r\n+  }\r\n+\r\n+  /// Check if currently recording\r\n+  Future<bool> isRecording() async {\r\n+    return await _recorder.isRecording();\r\n+  }\r\n+}\r\n"
                }
            ],
            "date": 1762859657986,
            "name": "Commit-0",
            "content": "import 'dart:io';\r\nimport 'package:record/record.dart';\r\nimport 'package:path_provider/path_provider.dart';\r\nimport 'package:path/path.dart' as path;\r\n\r\nclass AudioRecorderService {\r\n  final Record _record = Record();\r\n\r\n  Future<String?> startRecording() async {\r\n    if (await _record.hasPermission()) {\r\n      final dir = await getApplicationDocumentsDirectory();\r\n      final filePath = path.join(dir.path, 'audio_${DateTime.now().millisecondsSinceEpoch}.m4a');\r\n      await _record.start(path: filePath);\r\n      return filePath;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  Future<void> stopRecording() async {\r\n    await _record.stop();\r\n  }\r\n\r\n  Future<void> cancelRecording(String filePath) async {\r\n    final file = File(filePath);\r\n    if (await file.exists()) {\r\n      await file.delete();\r\n    }\r\n  }\r\n\r\n  Future<bool> isRecording() async => await _record.isRecording();\r\n}\r\n"
        }
    ]
}